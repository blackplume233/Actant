{
  "id": 22,
  "title": "CLI 包 console.log 违反质量规范 — 需引入结构化输出层",
  "status": "closed",
  "labels": [
    "cli",
    "enhancement",
    "priority:P2",
    "quality",
    "review"
  ],
  "milestone": null,
  "body": "## 审查发现\n\n`packages/cli` 中大量使用 `console.log/error`（30+ 处），违反 `.trellis/spec/backend/quality-guidelines.md` 中 \"Don't: console.log\" 的规定。\n\n## 证据\n\n涉及文件（共 12 个）：\n- `commands/daemon/start.ts` — 4 处 console.log\n- `commands/daemon/stop.ts` — 2 处\n- `commands/daemon/status.ts` — 10 处\n- `commands/agent/start.ts` — 1 处\n- `commands/agent/stop.ts` — 1 处\n- `commands/agent/status.ts` — 2 处\n- `commands/agent/list.ts` — 1 处\n- `commands/agent/create.ts` — 3 处\n- `commands/agent/destroy.ts` — 3 处\n- `commands/template/validate.ts` — 3 处\n- `commands/template/show.ts` — 1 处\n- `commands/template/load.ts` — 1 处\n- `commands/template/list.ts` — 1 处\n- `output/error-presenter.ts` — 8 处\n- `repl/repl.ts` — 2 处\n\n## 分析\n\nCLI 作为用户面向的输出层，使用 console.log 是常见做法。但项目质量规范明确禁止了这一点。需要做出选择：\n\n1. **严格路线**：引入 CLI 专用输出层（如 `CliPrinter` / `OutputAdapter`），封装所有用户面向输出，内部使用 pino logger\n2. **务实路线**：在质量规范中为 CLI 包添加例外说明，明确 CLI 的 console 使用规则\n\n## 建议\n\n建议采用方案 1，创建 `packages/cli/src/output/printer.ts` 统一管理所有终端输出，好处：\n- 便于统一切换输出格式（text/json/yaml）\n- 便于测试（mock printer 而非 console）\n- 与 `--format` CLI 选项自然对接\n- 消除质量规范的违规项",
  "author": "cursor-agent",
  "assignees": [],
  "relatedFiles": [],
  "relatedIssues": [],
  "taskRef": null,
  "githubRef": "blackplume233/AgentCraft#6",
  "closedAs": "completed",
  "comments": [
    {
      "text": "Closed as completed",
      "date": "2026-02-20T16:17:44",
      "author": "cursor-agent"
    }
  ],
  "createdAt": "2026-02-20T12:24:39",
  "updatedAt": "2026-02-20T16:17:44",
  "closedAt": "2026-02-20T16:17:44"
}
