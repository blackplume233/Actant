{
  "id": 20,
  "title": "CLI 包测试覆盖率为零 — 需补充单元测试",
  "status": "closed",
  "labels": [
    "cli",
    "enhancement",
    "priority:P2",
    "quality",
    "review"
  ],
  "milestone": null,
  "body": "## 审查发现\n\n`packages/cli` 包含 20 个源文件（commands、repl、output、client 等），但除了 1 个 e2e 测试文件（`e2e-cli.test.ts`，12 个测试），没有任何单元测试。\n\n## 证据\n\n### 无单元测试的源文件（20 个）\n\n| 模块 | 文件 |\n|------|------|\n| commands/daemon | start.ts, stop.ts, status.ts |\n| commands/template | validate.ts, show.ts, load.ts, list.ts |\n| commands/agent | start.ts, stop.ts, status.ts, list.ts, create.ts, destroy.ts |\n| repl | repl.ts |\n| output | error-presenter.ts, formatter.ts |\n| client | rpc-client.ts |\n| 其他 | daemon-entry.ts, program.ts, bin/actant.ts |\n\n### 对比其他包\n\n| 包 | 有测试 | 无测试 | 覆盖率 |\n|---|--------|--------|--------|\n| core | 16 | 4 | 80% |\n| shared | 3 | 3 | 50% |\n| api | 3 | 5 | 37.5% |\n| **cli** | **0** | **20** | **0%** |\n\n## 建议\n\n1. 优先为 `rpc-client.ts` 和 `error-presenter.ts` 添加单元测试（核心通信和错误处理逻辑）\n2. 为各 command handler 添加参数解析和逻辑分支的单元测试\n3. 考虑将 command 的业务逻辑从 CLI 框架代码中分离，便于单独测试\n4. 建议在 Roadmap 风险表中增加「CLI 包零测试覆盖」风险项",
  "author": "cursor-agent",
  "assignees": [],
  "relatedFiles": [],
  "relatedIssues": [],
  "taskRef": null,
  "githubRef": "blackplume233/Actant#5",
  "closedAs": "completed",
  "comments": [
    {
      "text": "[Review] 本次深度审查测试用例时同时发现：core 包 type-check 未通过（见 #24），以及测试类型安全与配对缺口（见 #25）。CLI 单元测试补充可与 #24 修复并行推进。",
      "date": "2026-02-20T13:17:12",
      "author": "cursor-agent"
    },
    {
      "text": "Closed as completed",
      "date": "2026-02-20T16:17:44",
      "author": "cursor-agent"
    }
  ],
  "createdAt": "2026-02-20T12:22:12",
  "updatedAt": "2026-02-20T16:17:44",
  "closedAt": "2026-02-20T16:17:44"
}
