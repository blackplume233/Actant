{
  "id": 47,
  "title": "WorkspaceBuilder Pipeline + AgentInitializer 迁移",
  "status": "open",
  "labels": ["feature", "architecture", "priority:P0", "phase3b"],
  "milestone": "mid-term",
  "body": "## 目标\n\n实现 WorkspaceBuilder 编排层（6 步 pipeline），将 AgentInitializer 从 ContextMaterializer 迁移到新 Builder 体系。\n\n## 依赖\n\n- #46 BackendBuilder + CursorBuilder + ClaudeCodeBuilder\n\n## 交付物\n\n### 1. WorkspaceBuilder\n\n```typescript\nclass WorkspaceBuilder {\n  registerBuilder(type, builder): void;\n  async build(instanceName, template, overrides?): Promise<BuildResult>;\n}\n```\n\nPipeline: resolve → validate → scaffold → materialize → inject → verify\n\n### 2. AgentInitializer 迁移\n\n- 注入 WorkspaceBuilder 替代 ContextMaterializer\n- `createInstance()` 调用 `builder.build()`\n\n### 3. CustomBuilder\n\n- 通过 `builderConfig` 自定义所有路径\n\n### 4. 清理\n\n- ContextMaterializer 标记 @deprecated\n- E2E 测试使用新 Builder 验证\n\n## 文件路径\n\n```\npackages/core/src/builder/\n  ├── workspace-builder.ts    # 编排层\n  └── custom-builder.ts       # 可配置后端\n```\n\n## 验收标准\n\n- [ ] WorkspaceBuilder pipeline 6 步完整\n- [ ] AgentInitializer 迁移成功\n- [ ] CustomBuilder 可配置路径\n- [ ] ContextMaterializer @deprecated\n- [ ] 现有 E2E 测试通过\n- [ ] 新增 Builder 集成测试",
  "author": "cursor-agent",
  "assignees": [],
  "relatedFiles": [
    "packages/core/src/builder/workspace-builder.ts",
    "packages/core/src/builder/custom-builder.ts",
    "packages/core/src/initializer/agent-initializer.ts",
    "packages/core/src/initializer/context/context-materializer.ts"
  ],
  "relatedIssues": [39, 46],
  "taskRef": null,
  "githubRef": null,
  "closedAs": null,
  "comments": [],
  "createdAt": "2026-02-21T21:00:00",
  "updatedAt": "2026-02-21T21:00:00",
  "closedAt": null
}
