{
  "id": 50,
  "title": "EmployeeScheduler + AgentManager 集成 + CLI 命令",
  "status": "closed",
  "labels": [
    "feature",
    "scheduler",
    "cli",
    "priority:P0",
    "phase3c"
  ],
  "milestone": "mid-term",
  "body": "## 目标\n\n实现 EmployeeScheduler 编排层，集成到 AgentManager，扩展模板 schema，新增 CLI 命令。\n\n## 依赖\n\n- #48 TaskQueue + Dispatcher\n- #49 InputRouter + Sources\n\n## 交付物\n\n### 1. EmployeeScheduler\n\n编排 InputRouter + TaskQueue + TaskDispatcher：\n- 从 ScheduleConfig 创建对应 InputSources\n- 管理调度生命周期（start/stop/pause/resume）\n\n### 2. 模板 Schema 扩展\n\n```typescript\nconst ScheduleConfigSchema = z.object({\n  heartbeat: z.object({ enabled, intervalMs, prompt, suppressNoAction }).optional(),\n  cron: z.array(z.object({ schedule, prompt, label, timezone })).optional(),\n  hooks: z.array(z.object({ event, prompt })).optional(),\n  webhooks: z.array(z.object({ path, secret, promptTemplate })).optional(),\n  n8n: z.object({ enabled, apiUrl, callbackUrl }).optional(),\n});\n```\n\nAgentTemplate 新增 `schedule` 字段。\n\n### 3. AgentManager 集成\n\n- `startAgent()`: 如果 launchMode=acp-service 且有 schedule → 启动 EmployeeScheduler\n- `stopAgent()`: 停止 EmployeeScheduler\n\n### 4. RPC + CLI\n\nRPC: `agent.dispatch` / `agent.tasks` / `agent.logs`\nCLI:\n- `agent dispatch <name> \"prompt\"` — 手动派发\n- `agent tasks <name>` — 查看队列\n- `agent logs <name>` — 查看执行历史\n- `schedule list <name>` / `schedule pause` / `schedule resume`\n\n### 5. Webhook + N8N (P2 可选)\n\n- WebhookInput + Hono HTTP handler + HMAC\n- N8N Bridge（payload 解析 + callback）\n\n## 验收标准\n\n- [ ] EmployeeScheduler 正确编排\n- [ ] 模板 schedule 字段可解析\n- [ ] AgentManager 在 acp-service 模式自动启动调度\n- [ ] CLI dispatch/tasks/logs 命令可用\n- [ ] 集成测试覆盖",
  "author": "cursor-agent",
  "assignees": [],
  "relatedFiles": [
    "packages/core/src/scheduler/employee-scheduler.ts",
    "packages/core/src/manager/agent-manager.ts",
    "packages/core/src/template/schema/template-schema.ts",
    "packages/cli/src/commands/schedule.ts"
  ],
  "relatedIssues": [
    40,
    48,
    49
  ],
  "taskRef": null,
  "githubRef": null,
  "closedAs": "completed",
  "comments": [
    {
      "text": "Closed as completed",
      "date": "2026-02-22T07:59:11",
      "author": "cursor-agent"
    }
  ],
  "createdAt": "2026-02-21T21:00:00",
  "updatedAt": "2026-02-22T07:59:11",
  "closedAt": "2026-02-22T07:59:11"
}
