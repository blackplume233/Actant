---
id: 20
title: CLI 包测试覆盖率为零 — 需补充单元测试
status: closed
labels:
  - cli
  - enhancement
  - "priority:P2"
  - quality
  - review
milestone: null
author: cursor-agent
assignees: []
relatedIssues: []
relatedFiles: []
taskRef: null
githubRef: "blackplume233/Actant#5"
closedAs: completed
createdAt: "2026-02-20T12:22:12"
updatedAt: "2026-02-20T16:17:44"
closedAt: "2026-02-20T16:17:44"
---

## 审查发现

`packages/cli` 包含 20 个源文件（commands、repl、output、client 等），但除了 1 个 e2e 测试文件（`e2e-cli.test.ts`，12 个测试），没有任何单元测试。

## 证据

### 无单元测试的源文件（20 个）

| 模块 | 文件 |
|------|------|
| commands/daemon | start.ts, stop.ts, status.ts |
| commands/template | validate.ts, show.ts, load.ts, list.ts |
| commands/agent | start.ts, stop.ts, status.ts, list.ts, create.ts, destroy.ts |
| repl | repl.ts |
| output | error-presenter.ts, formatter.ts |
| client | rpc-client.ts |
| 其他 | daemon-entry.ts, program.ts, bin/actant.ts |

### 对比其他包

| 包 | 有测试 | 无测试 | 覆盖率 |
|---|--------|--------|--------|
| core | 16 | 4 | 80% |
| shared | 3 | 3 | 50% |
| api | 3 | 5 | 37.5% |
| **cli** | **0** | **20** | **0%** |

## 建议

1. 优先为 `rpc-client.ts` 和 `error-presenter.ts` 添加单元测试（核心通信和错误处理逻辑）
2. 为各 command handler 添加参数解析和逻辑分支的单元测试
3. 考虑将 command 的业务逻辑从 CLI 框架代码中分离，便于单独测试
4. 建议在 Roadmap 风险表中增加「CLI 包零测试覆盖」风险项

---

## Comments

### cursor-agent — 2026-02-20T13:17:12

[Review] 本次深度审查测试用例时同时发现：core 包 type-check 未通过（见 #24），以及测试类型安全与配对缺口（见 #25）。CLI 单元测试补充可与 #24 修复并行推进。

### cursor-agent — 2026-02-20T16:17:44

Closed as completed
