{
  "id": 38,
  "title": "统一组件管理体系 — Skill / Prompt / Plugin 完整 CRUD",
  "status": "open",
  "labels": [
    "feature",
    "domain",
    "priority:P1"
  ],
  "milestone": "mid-term",
  "body": "## 目标\n\n将 Skill、Prompt、Plugin（Cloud Code 插件）纳入统一的组件管理框架，支持完整 CRUD + import/export + 搜索过滤。\n\n**当前状态**：Domain Managers（Skill/Prompt/MCP/Workflow）只有 list/show 只读能力，缺乏 add/remove/update/import/export。Plugin 管理完全不存在。\n\n## Plugin 概念\n\nPlugin 指 **Agent 侧的能力扩展**：\n- Claude Code Plugin（memory plugin、web-search plugin 等）\n- Cursor Extension\n- Custom tool packages\n\n不同于 AgentCraft 自身的系统级插件（#13 Phase 4）。\n\n## 设计要点\n\n### 1. 增强 BaseComponentManager\n\n```typescript\n// 新增方法\nasync add(component: T, persist?: boolean): Promise<void>;\nasync update(name: string, patch: Partial<T>): Promise<T>;\nasync remove(name: string, persist?: boolean): Promise<boolean>;\nasync importFromFile(filePath: string): Promise<T>;\nasync importFromUrl(url: string): Promise<T>;\nasync exportToFile(name: string, filePath: string): Promise<void>;\nsearch(query: string): T[];\nfilter(predicate: (c: T) => boolean): T[];\n```\n\n### 2. PluginManager + PluginDefinition\n\n```typescript\nconst PluginDefinitionSchema = z.object({\n  name: z.string().min(1),\n  description: z.string().optional(),\n  type: z.enum([\"claude-code\", \"cursor\", \"universal\"]),\n  install: z.discriminatedUnion(\"method\", [\n    z.object({ method: z.literal(\"npm\"), package: z.string(), version: z.string().optional() }),\n    z.object({ method: z.literal(\"file\"), path: z.string() }),\n    z.object({ method: z.literal(\"config\"), target: z.string(), content: z.record(z.string(), z.unknown()) }),\n  ]),\n  permissions: z.array(z.string()).optional(),\n  env: z.record(z.string(), z.string()).optional(),\n  compatibleBackends: z.array(z.enum([\"claude-code\", \"cursor\", \"custom\"])).optional(),\n  tags: z.array(z.string()).optional(),\n});\n```\n\n### 3. CLI 命令扩展\n\n```bash\n# Skill CRUD\nagentcraft skill add <file|url>\nagentcraft skill create\nagentcraft skill remove <name>\nagentcraft skill export <name> [--out]\n\n# Prompt CRUD\nagentcraft prompt add <file|url>\nagentcraft prompt create\nagentcraft prompt remove <name>\nagentcraft prompt export <name> [--out]\n\n# Plugin 全套\nagentcraft plugin list\nagentcraft plugin show <name>\nagentcraft plugin add <file|url>\nagentcraft plugin create\nagentcraft plugin remove <name>\nagentcraft plugin install <name> <agent>\n```\n\n### 4. RPC 方法\n\n```\ndomain.skill.add / domain.skill.update / domain.skill.remove / domain.skill.import\ndomain.prompt.add / domain.prompt.update / domain.prompt.remove\ndomain.plugin.list / domain.plugin.show / domain.plugin.add / domain.plugin.remove / domain.plugin.install\n```\n\n### 5. DomainContext 扩展\n\n`domainContext.plugins: string[]` — 模板中引用 Plugin 名称列表。\n\n## 实现计划\n\n1. 增强 `BaseComponentManager`：add/update/remove/import/export/search\n2. 创建 `PluginManager` + `PluginDefinition` schema（`packages/core/src/domain/plugin/`）\n3. 扩展 CLI 命令：skill/prompt CRUD + plugin 全套\n4. 扩展 RPC handlers\n5. `configs/plugins/` 目录 + 至少 3 个示例插件定义\n6. 集成测试\n\n## 验收标准\n\n- [ ] Skill/Prompt 支持 add/update/remove + 持久化\n- [ ] PluginManager 完整实现，支持 CRUD\n- [ ] CLI 新增 skill/prompt/plugin 管理命令\n- [ ] configs/plugins/ 至少 3 个示例插件定义\n- [ ] 导入/导出功能可用\n- [ ] 模板 domainContext 支持 plugins 字段\n- [ ] RPC 方法全部实现并测试",
  "author": "human",
  "assignees": [],
  "relatedFiles": [
    "packages/core/src/domain/base-component-manager.ts",
    "packages/core/src/domain/skill/skill-manager.ts",
    "packages/core/src/domain/prompt/prompt-manager.ts",
    "packages/core/src/domain/mcp/mcp-config-manager.ts",
    "packages/core/src/domain/index.ts",
    "packages/core/src/template/schema/template-schema.ts",
    "packages/cli/src/commands/skill.ts",
    "packages/cli/src/commands/prompt.ts",
    "packages/api/src/handlers/domain-handlers.ts"
  ],
  "relatedIssues": [23, 24, 39, 13],
  "taskRef": null,
  "githubRef": null,
  "closedAs": null,
  "comments": [],
  "createdAt": "2026-02-21T12:00:00",
  "updatedAt": "2026-02-21T12:00:00",
  "closedAt": null
}
