# Code Review

对工程中的代码进行严格审查，特别关注测试用例的完整性和质量。

## 审查范围

1. **获取变更文件**
   ```bash
   git diff main...HEAD --name-only
   ```

2. **识别新增/修改的代码**
   - 源文件 (.ts, .tsx, .js, .py 等)
   - 测试文件 (*.test.*, *.spec.*, __tests__/)

## 审查步骤

### 1. 测试用例审查（最高优先级）

对每个测试文件进行严格检查：

- [ ] **测试覆盖率**：每个公共函数/方法是否有对应的测试？
- [ ] **测试质量**：测试是否真正验证了行为，而不仅仅是执行了代码？
- [ ] **边界条件**：是否测试了错误输入、边界值、异常情况？
- [ ] **测试独立性**：测试之间是否有副作用依赖？
- [ ] **Mock/Stub**：外部依赖是否正确隔离？
- [ ] **断言质量**：断言是否具体、有意义？
- [ ] **测试命名**：测试名称是否清晰描述被测行为？

### 2. 代码质量审查

- [ ] **类型安全**：TypeScript 类型是否完整、准确？
- [ ] **错误处理**：错误是否被适当捕获和处理？
- [ ] **代码重复**：是否存在可提取的重复模式？
- [ ] **命名规范**：变量、函数、类名是否清晰？
- [ ] **注释质量**：复杂逻辑是否有必要注释？
- [ ] **依赖管理**：导入是否整洁，无循环依赖？

### 3. 架构合规审查

- [ ] **目录结构**：文件是否放在正确的位置？
- [ ] **分层原则**：是否遵循项目的分层架构？
- [ ] **接口契约**：公共 API 是否稳定、文档化？

## 输出格式

### 如果审查通过

生成综合设计报告：

```markdown
# Code Review Report - PASSED

## 变更概览
- 变更文件数: X
- 新增代码行数: X
- 删除代码行数: X
- 测试文件数: X

## 功能描述
<描述这次变更实现了什么功能>

## 架构设计
<描述关键的设计决策和架构模式>

## 测试覆盖
- 单元测试: X 个
- 集成测试: X 个
- 关键路径覆盖: <描述>

## 质量评估
- [OK] 测试完整性
- [OK] 类型安全
- [OK] 错误处理
- [OK] 代码风格

## 总结
<综合评价>
```

### 如果审查不通过

记录所有问题：

```markdown
# Code Review Report - ISSUES FOUND

## 严重问题（必须修复）

### 1. [文件路径]
**问题**: <具体问题描述>
**影响**: <为什么这是个问题>
**建议**: <如何修复>

## 中等问题（建议修复）

### 2. [文件路径]
**问题**: <具体问题描述>
**建议**: <如何修复>

## 轻微问题（可选优化）

### 3. [文件路径]
**问题**: <具体问题描述>

## 测试问题汇总

| 文件 | 问题类型 | 描述 |
|------|----------|------|
| | | |

## 修复清单

- [ ] 问题1: [文件路径]
- [ ] 问题2: [文件路径]
```

## 执行指令

1. 首先获取 git 变更状态
2. 对每个变更文件进行审查
3. 特别关注对应的测试文件
4. 按照上述格式输出审查报告
5. 如果不通过，详细记录每个问题以便后续修复
